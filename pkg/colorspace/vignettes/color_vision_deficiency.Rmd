---
title: "Color Vision Deficiency Emulation"
output:
  html_document:
    toc: true
    toc_float: true
    theme: flatly
bibliography: color.bib
vignette: >
  %\VignetteIndexEntry{Color Vision Deficiency Emulation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteDepends{colorspace}
  %\VignetteKeywords{RGB, sRGB, XYZ, LUV, LAB, HLS, HSV, HCL}
  %\VignettePackage{colorspace}
---

```{r preliminaries, echo=FALSE, message=FALSE}
library("colorspace")
```

## Overview

Using the physiologically-based model for simulating color vision deficiency (CVD)
of @color:Machado+Oliveira+Fernandes:2009, deutanope, protanope, and tritanope vision can be emulated.
The workhorse function to do so is `simulate_cvd()` which can take any vector
of valid R colors and transform them according to a certain CVD transformation
matrix and transformation equation. The transformation matrices have been established
by @color:Machado+Oliveira+Fernandes:2009 and are provided in objects `protanomaly_cvd`,
`deutanomaly_cvd`, and `tritanomaly_cvd`.

The convenience interfaces `deutan()`, `protan()`, and `tritan()` are the high-level functions for
simulating the corresponding kind of color blindness with a given severity (calling
`simulate_cvd()` internally).

For further guidance on color blindness in relation to statistical graphics
see @color:Lumley:2006 which accompanies the R package _dichromat_ based on
earlier emulation techniques.


## Illustration: Heatmap with sequential palette

To illustrate that poor color choices can severely reduce the usefulness of a statistical
graphic for readers with color vision deficiencies, we employ the infamous RGB rainbow
color palette in a heatmap. In base R this can be generated by `rainbow(11, end = 2/3)`
ranging from red (for high values) to blue (for low values).

The poor results for the RGB rainbow palette are contrasted with a proper sequential
palette ranging dark blue to light yellow: `sequential_hcl(11, "Blue-Yellow")`.

The statistical graphic employed for illustration is a heatmap of the well-known
Maunga Whau `volcano` data from base R. This heatmap is easily available as
`demoplot(..., "heatmap")` where `...` is color vector to be used, e.g.,

```{r colors}
rainbow(11, end = 2/3)
deutan(rainbow(11, end = 2/3))
```

and so on. To aid the interpretation of the heatmap a perspective display using
only gray shades is included first.

```{r volcano, echo = FALSE, fig.height = 3, fig.width = 5.5, fig.align = "center", dev = "png"}
z <- 2 * volcano
x <- 10 * (1:nrow(z))
y <- 10 * (1:ncol(z))
par(mar = rep(0, 4))
persp(x, y, z, theta = 10, phi = 30, col = "lightgray", scale = FALSE,
  ltheta = 100, shade = 0.5, border = NA, box = FALSE)
```

Subsequently, all combinations of palette and color vision deficiency are visualized.
Additionally, a grayscale version is created with `desaturate()`.

```{r heatmap-sequential, echo = FALSE, fig.height = 15, fig.width = 9, fig.align = "center", dev = "png", dpi = 48, out.width = "100%"}
par(mfrow = c(5, 2), mar = rep(0.5, 4), oma = c(1, 6.7, 3, 1), las = 1)
rain <- rainbow(11, end = 2/3)
blyl <- sequential_hcl(11, "Blue-Yellow")
demoplot(rain, "heatmap")
mtext("Original", side = 2, line = 1)
mtext("rainbow(11, end = 2/3)", line = 1)
demoplot(blyl, "heatmap")
mtext("sequential_hcl(11, \"Blue-Yellow\")", line = 1)
demoplot(desaturate(rain), "heatmap")
mtext("Grayscale", side = 2, line = 1)
demoplot(desaturate(blyl), "heatmap")
demoplot(deutan(rain), "heatmap")
mtext("Deutanope", side = 2, line = 1)
demoplot(deutan(blyl), "heatmap")
demoplot(protan(rain), "heatmap")
mtext("Protanope", side = 2, line = 1)
demoplot(protan(blyl), "heatmap")
demoplot(tritan(rain), "heatmap")
mtext("Tritanope", side = 2, line = 1)
demoplot(tritan(blyl), "heatmap")
```

This clearly shows how poorly the RGB rainbow performs while the HCL-based
blue-yellow palette works reasonably well in all settings. The most important
problem of the RGB rainbow is that it is not monotonic in luminance, making
correct interpretation quite hard. Moreover, the red-green contrasts deteriorate
substantially in the dichromatic emulations.


## Illustration: Map with diverging palette

As another example for the poor performance of the RGB rainbow we employ a
shaded map. This is available as `demoplot(..., "map")` and is based on county
polygons for Alabama, Georgia, and South Carolina along with an artifical variable
used for coloring.

Often the red-yellow-green RGB spectrum is used for a diverging palette with 
yellow as the neutral value. In base R this can be generated by
`rainbow(11, end = 1/3)`. However, this palette has again a number of weaknesses,
especially that the green-yellow part of the palette almost collapses to the same
color when desaturated or color blindness is emulated.

To illustrate that much more balanced palettes for the same purpose are available
the `Geyser` palette [mimicked from @color:CARTO] is adopted:
`divergingx_hcl(11, "Geyser", rev = TRUE)`. This also goes from red via yellow to
a green/blue and hence needs the `divergingx_hcl()` function (as opposed to
`diverging_hcl()` which always uses a neutral gray).

```{r map-diverging, echo = FALSE, fig.height = 13, fig.width = 9, fig.align = "center", dev = "png", dpi = 48, out.width = "100%"}
par(mfrow = c(5, 2), mar = rep(0.5, 4), oma = c(1, 6.7, 3, 1), las = 1)
rain <- rainbow(11, end = 1/3)
gysr <- divergingx_hcl(11, "Geyser", rev = TRUE)
demoplot(rain, "map")
mtext("Original", side = 2, line = 1)
mtext("rainbow(11, end = 1/3)", line = 1)
demoplot(gysr, "map")
mtext("divergingx_hcl(11, \"Geyser\", rev = TRUE)", line = 1)
demoplot(desaturate(rain), "map")
mtext("Grayscale", side = 2, line = 1)
demoplot(desaturate(gysr), "map")
demoplot(deutan(rain), "map")
mtext("Deutanope", side = 2, line = 1)
demoplot(deutan(gysr), "map")
demoplot(protan(rain), "map")
mtext("Protanope", side = 2, line = 1)
demoplot(protan(gysr), "map")
demoplot(tritan(rain), "map")
mtext("Tritanope", side = 2, line = 1)
demoplot(tritan(gysr), "map")
```

While many versions of the RGB rainbow displays are hard to read because
they do not bring out any differences in the green-yellow arm of the palette,
the HCL-based palette works reasonably well in all settings. Only the grayscale
version cannot bring out the different arms of the palette. However, at least
both directions of deviation are visible even if they cannot be distinguished.
This is preferable to the RGB rainbow which hides all differences in the
green-yellow arm of the palette. (However, if grayscale printing is desired
a sequential rather than a diverging palette is probably necessary.)


## References
